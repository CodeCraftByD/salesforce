public class VFC_GenerateContractsPDF {
    public Contract objContract{get;set;}
    public Opportunity objOpportunity {get; set;}
    public List<OpportunityLineItem> lstOpportunityLineItems {get; set;}
    public List<OpportunityLineItem> lstOpportunityLineItemsStandard {get; set;}
    public List<OpportunityLineItem> lstOpportunityLineItemsTransaction {get; set;}
    public List<Id> lstPromoDiscountProducts {get; set;} //CRM 9102
    public String lmProductSelection {get; set;}
    public Contract objCon{get; set;}
    public String startDateObj {get; set;}
    public List<opportunityLineItemsWrapper> lineItemsWrapper {get; set;}
    public List<AddOnLineItemsWrapper> addOnWrap {get; set;}

    public VFC_GenerateContractsPDF(ApexPages.StandardController stdController){
        lineItemsWrapper = new List<opportunityLineItemsWrapper>();
        lstOpportunityLineItems = new List<OpportunityLineItem>();
        lstOpportunityLineItemsStandard  = new List<OpportunityLineItem>();
        lstOpportunityLineItemsTransaction = new List<OpportunityLineItem>();
        lstPromoDiscountProducts = new List<Id>(); //CRM 9102
        Map<String, Promo_Discount_Products__c> productDetailsMap = new Map<String, Promo_Discount_Products__c>();//CRM 9102
        List<Promo_Discount_Products__c> promoDiscountProductsList = new List<Promo_Discount_Products__c>(); //CRM 9102
        String productCode; //CRM 9102
        this.objContract= (Contract)stdCOntroller.getRecord();
        objCon = [Select id, Opportunity__c, ContractNumber,ContractTerm,StartDate from Contract where id=:objContract.Id Limit 1];
        Date myDate = system.today();
        DateTime startDate = datetime.newInstance(system.today().year(), system.today().month(), system.today().day());
        startDateObj =  startDate.format('dd/MM/YYYY');
        String oppId = objCon.Opportunity__c;
        objOpportunity = new Opportunity();
        objOpportunity = [Select id, 
                        MaxTrialPeriod__c,BusinessName__c,ContractTerm__c,QuoteComments__c,Account.BillingStreet, Account.BillingCity, 
                        Account.BillingState, Owner.FirstName, LM_Products_Selection__c, Contact_Name__r.FirstName,Contact_Name__r.Email,Contact_Name__r.Name,Account.BillingCountry, Account.BillingPostalCode,
                        Account.Phone, Contact_Name__r.Title,Contact_Name__r.Phone,Contact_Name__r.Language__r.EmailCode__c,
                        Contact_Name__r.LastName,Account.Name, D_Comm_Rate__c, DActivationRequest__c, Account.DemandPlusCommissionRate__c, CustomerInterestedInPay__c  from Opportunity WHERE id= :oppId Limit 1];

        lstOpportunityLineItems = [SELECT Name,                    
                                    TBV_Percent__c,
                                    Bundle__c,
                                    BundleCode__c,
                                    Bundle__r.Name,                    
                                    currencyISOCode,
                                    Bundle__r.Total_Bundle_Price__c,
                                    Opportunity.TotalSetupPrice__c,
                                    Product2.Name,
                                    Product2.MarketingProduct__c,
                                    Product2.ProductType__c,
                                    ProductCode,
                                    Expected_Net_MRR__c,
                                    Setup_Price__c,
                                    UnitPrice,
                                    Expected_set_up_fee__c,
                                    Opportunity.Total_Setup_After_Discount_RUS__c,
                                     Opportunity.Contact_Name__r.Language__r.EmailCode__c,
                                     Opportunity.Contact_Name__r.Language__r.Code__c, /*9102*/
                                    Opportunity.Total_Setup_Retail_Price_RUS__c,
                                    Opportunity.Setup_Fee_Discount__c,
                                    Opportunity.Total_MRR_After_Discount_RUS__c,
                                    Opportunity.Total_MRR_Retail_Price_RUS__c,
                                    Opportunity.Sales_Discount__c,
                                    Opportunity.TotalBundleSetupPrice__c,
                                    Opportunity.LM_Products_Selection__c,
                                    Opportunity.Contact_Name__r.LanguageName__c,
                                    Opportunity.Promo_Discount__r.PromoCode__c,
                                    Opportunity.Promo_Discount__r.PromoDetails__c,
                                    Opportunity.Promo_Discount__r.PromoDetailsItalian__c,
                                    Opportunity.Promo_Discount__r.PromoDetailsPortuguese__c,
                                    Opportunity.Promo_Discount__r.PromoDetailsSpanish__c,
                                    Opportunity.Promo_Discount__r.PromoDetailsFrench__c,
                                    Opportunity.Promo_Discount__r.PromoDetailsGerman__c,
                                    Opportunity.Promo_Discount__r.PromoDetailsChinese__c,
                                    Opportunity.Promo_Discount__r.PromoDetailsIndonesian__c,
                                    Opportunity.Promo_Discount__r.PromoDetailsThai__c,
                                    Opportunity.Promo_Discount__r.PromoDetailsVietnamese__c,
                                    //CRM 9102 start
                                    Opportunity.Transaction_Promo_Discount__c,
                                    Opportunity.Transaction_Promo_Discount__r.PromoCode__c,
                                    //CRM 9102 end
                                    //CRM 11446 start
                                    Opportunity.Incentive_Amount__c,
                                    Opportunity.Smart_Platform_Incentive__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoCode__c,
                                    Opportunity.Smart_Platform_Incentive__r.MinimumContractTerm__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoDetails__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoDetailsItalian__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoDetailsPortuguese__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoDetailsSpanish__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoDetailsFrench__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoDetailsGerman__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoDetailsChinese__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoDetailsIndonesian__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoDetailsThai__c,
                                    Opportunity.Smart_Platform_Incentive__r.PromoDetailsVietnamese__c,
                                    //CRM 11446 end
                                    Opportunity.BillMPAsBundle__c,
                                    Commission_Quoted__c
                                    FROM OpportunityLineItem 
                                    WHERE OpportunityId =: oppId
                                    AND Is_Product_Dropped__c = FALSE 
                                    AND ((BundleCode__c NOT IN :CustomConstants.lhBundleList OR Little_Hotelier_Bundle_Priced_Product__c = true) OR Product2.ProductType__c = 'Transaction')  ORDER BY UnitPrice desc];
        
        
        
        
        lmProductSelection = objOpportunity.LM_Products_Selection__c;
        for(OpportunityLineItem oli : lstOpportunityLineItems){
            if(oli.Product2.ProductType__c != 'Transaction'){
              lstOpportunityLineItemsStandard.add(oli);
            }else{
                lstOpportunityLineItemsTransaction.add(oli); 
                lstPromoDiscountProducts.add(oli.Opportunity.Transaction_Promo_Discount__c); //CRM 9102
            }
        }
        //CRM 9102 start
        if(lstPromoDiscountProducts.size()>0){
            promoDiscountProductsList = [select Product__r.ProductCode, Promo_Details__c,Promo_Details_Vietnamese__c,Promo_Details_Thai__c,Promo_Details_Indonesian__c,
                                                                            Promo_Details_Chinese__c,Promo_Details_German__c,Promo_Details_French__c,Promo_Details_Spanish__c,
                                                                            Promo_Details_Portuguese__c,Promo_Details_Italian__c 
                                                                            from Promo_Discount_Products__c where Promo_Discounts__r.Id IN: lstPromoDiscountProducts];
        }
       
        for (Promo_Discount_Products__c promoProduct : promoDiscountProductsList) {
            productCode = promoProduct.Product__r != null ? promoProduct.Product__r.ProductCode : null;
            
            if (productCode != null) {
                productDetailsMap.put(productCode, promoProduct);
            }
        }
        //CRM 9102 End
        opportunityLineItemsWrapper objLineItemWrapper = new opportunityLineItemsWrapper(lstOpportunityLineItemsStandard);
        
        lineItemsWrapper.add(objLineItemWrapper);
        addOnWrap = new List<AddOnLineItemsWrapper>();
        System.debug('lstOpportunityLineItemsTransaction ' + lstOpportunityLineItemsTransaction);
        addOnWrap.add(new AddOnLineItemsWrapper(lstOpportunityLineItemsStandard, lstOpportunityLineItemsTransaction, objOpportunity,promoDiscountProductsList,productDetailsMap));
    }
    public class opportunityLineItemsWrapper{
        public String promoDetails {get;set;}
        public String languagePromoDetails {get;set;}
        public String smOrLHBrandingClass {get;set;}
        public Boolean isNewLang {get;set;}
        public String isoCode{get; set;}
        public Decimal TotSalePriceRetail{get; set;}
        public Decimal TotSetupPriceRetail{get; set;}
        public Decimal TotSalePriceDiscounted{get; set;}
        public Decimal TotSetupPriceDiscounted{get; set;} 
        public Decimal TBVPercent {get; set;}   
        public Decimal SalesDiscount {get; set;}   
        public Decimal SetupDiscount {get; set;}   
        public String PromoDiscount {get; set;}
        public String SmartPlatformIncentive {get; set;} //CRM 11446
        public String IncentiveAmount {get; set;} //CRM 11446
        public String MonthlyIncentive {get; set;} //CRM 11446
        public string productsHTML{get; set;}
        public List<Opportunitylineitem> obj{get; set;}
        public opportunityLineItemsWrapper(List<Opportunitylineitem> olis){
            isNewLang = true;
            productsHTML = '';
            if(olis != NULL && !olis.isEmpty() && olis[0].Opportunity.Contact_Name__r.LanguageName__c != NULL){
                String language = olis[0].Opportunity.Contact_Name__r.LanguageName__c;
                // CRM 11446 start
                if (language.containsIgnoreCase('german')) {
                    if (olis[0].Opportunity.Promo_Discount__r != null &&
                        olis[0].Opportunity.Promo_Discount__r.PromoDetailsGerman__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Promo_Discount__r.PromoDetailsGerman__c;
                    } else if (olis[0].Opportunity.Smart_Platform_Incentive__r != null &&
                            olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsGerman__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsGerman__c;
                    }

                } else if (language.containsIgnoreCase('french')) {
                    if (olis[0].Opportunity.Promo_Discount__r != null &&
                        olis[0].Opportunity.Promo_Discount__r.PromoDetailsFrench__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Promo_Discount__r.PromoDetailsFrench__c;
                    } else if (olis[0].Opportunity.Smart_Platform_Incentive__r != null &&
                            olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsFrench__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsFrench__c;
                    }

                } else if (language.containsIgnoreCase('spanish')) {
                    if (olis[0].Opportunity.Promo_Discount__r != null &&
                        olis[0].Opportunity.Promo_Discount__r.PromoDetailsSpanish__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Promo_Discount__r.PromoDetailsSpanish__c;
                    } else if (olis[0].Opportunity.Smart_Platform_Incentive__r != null &&
                            olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsSpanish__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsSpanish__c;
                    }

                } else if (language.containsIgnoreCase('portuguese')) {
                    if (olis[0].Opportunity.Promo_Discount__r != null &&
                        olis[0].Opportunity.Promo_Discount__r.PromoDetailsPortuguese__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Promo_Discount__r.PromoDetailsPortuguese__c;
                    } else if (olis[0].Opportunity.Smart_Platform_Incentive__r != null &&
                            olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsPortuguese__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsPortuguese__c;
                    }

                } else if (language.containsIgnoreCase('italian')) {
                    if (olis[0].Opportunity.Promo_Discount__r != null &&
                        olis[0].Opportunity.Promo_Discount__r.PromoDetailsItalian__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Promo_Discount__r.PromoDetailsItalian__c;
                    } else if (olis[0].Opportunity.Smart_Platform_Incentive__r != null &&
                            olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsItalian__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsItalian__c;
                    }

                } else if (isNewLang && olis[0].Opportunity.Contact_Name__r.Language__r.EmailCode__c == 'zh-TW') {
                    if (olis[0].Opportunity.Promo_Discount__r != null &&
                        olis[0].Opportunity.Promo_Discount__r.PromoDetailsChinese__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Promo_Discount__r.PromoDetailsChinese__c;
                    } else if (olis[0].Opportunity.Smart_Platform_Incentive__r != null &&
                            olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsChinese__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsChinese__c;
                    }

                } else if (isNewLang && language.containsIgnoreCase('indonesian')) {
                    if (olis[0].Opportunity.Promo_Discount__r != null &&
                        olis[0].Opportunity.Promo_Discount__r.PromoDetailsIndonesian__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Promo_Discount__r.PromoDetailsIndonesian__c;
                    } else if (olis[0].Opportunity.Smart_Platform_Incentive__r != null &&
                            olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsIndonesian__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsIndonesian__c;
                    }

                } else if (isNewLang && language.containsIgnoreCase('thai')) {
                    if (olis[0].Opportunity.Promo_Discount__r != null &&
                        olis[0].Opportunity.Promo_Discount__r.PromoDetailsThai__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Promo_Discount__r.PromoDetailsThai__c;
                    } else if (olis[0].Opportunity.Smart_Platform_Incentive__r != null &&
                            olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsThai__c != null) {
                        languagePromoDetails = olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetailsThai__c;
                    }
                }
                // CRM 11446 end
                /*else if(isNewLang && language.containsIgnoreCase('vietnamese') && olis[0].Opportunity.Promo_Discount__r.PromoDetailsVietnamese__c != NULL){
                    languagePromoDetails = olis[0].Opportunity.Promo_Discount__r.PromoDetailsVietnamese__c;
                }*/
            
                promoDetails = olis[0].Opportunity.Promo_Discount__r != null && olis[0].Opportunity.Promo_Discount__r.PromoDetails__c != null ? 
                                olis[0].Opportunity.Promo_Discount__r.PromoDetails__c
                                : (olis[0].Opportunity.Smart_Platform_Incentive__r != null && olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetails__c != null
                                ? olis[0].Opportunity.Smart_Platform_Incentive__r.PromoDetails__c
                                : null);       //CRM 11446
          
            }
            if(olis != NULL && !olis.isEmpty() && olis[0].Opportunity.LM_Products_Selection__c != NULL && 
                olis[0].Opportunity.LM_Products_Selection__c.contains('LH')){
                smOrLHBrandingClass = 'background: #FFA078;height: 25px;color: #fff;';    //#ff704a
            }
            else{
                smOrLHBrandingClass = 'background: #0B7DC5;height: 25px;color: #fff;';    
            }
            //assign variables
            obj = olis;
            IncentiveAmount = olis[0].Opportunity.Incentive_Amount__c != null ? String.valueOf(olis[0].Opportunity.Incentive_Amount__c): null;  //CRM 11446
            MonthlyIncentive = olis[0].Opportunity.Incentive_Amount__c != null ? String.valueOf(olis[0].Opportunity.Incentive_Amount__c/olis[0].Opportunity.Smart_Platform_Incentive__r.MinimumContractTerm__c): null;  //CRM 11446
            isoCode = olis[0].currencyISOCode;
            TotSalePriceRetail = olis[0].Opportunity.Total_MRR_Retail_Price_RUS__c != null ? olis[0].Opportunity.Total_MRR_Retail_Price_RUS__c: 0;
            TotSetupPriceRetail = olis[0].Opportunity.Total_Setup_Retail_Price_RUS__c != null ? olis[0].Opportunity.Total_Setup_Retail_Price_RUS__c: 0;
            TotSalePriceDiscounted = olis[0].Opportunity.Total_MRR_After_Discount_RUS__c != null ? olis[0].Opportunity.Total_MRR_After_Discount_RUS__c: 0;
            TotSetupPriceDiscounted = olis[0].Opportunity.Total_Setup_After_Discount_RUS__c != null ?  olis[0].Opportunity.Total_Setup_After_Discount_RUS__c : 0;
            TBVPercent = 0;
            SalesDiscount = olis[0].Opportunity.Sales_Discount__c != null ?  olis[0].Opportunity.Sales_Discount__c : 0;
            SetupDiscount = olis[0].Opportunity.Setup_Fee_Discount__c != null ?  olis[0].Opportunity.Setup_Fee_Discount__c : 0;
            PromoDiscount = olis[0].Opportunity.Promo_Discount__r.PromoCode__c != null ?  olis[0].Opportunity.Promo_Discount__r.PromoCode__c : null;
            SmartPlatformIncentive = olis[0].Opportunity.Smart_Platform_Incentive__r.PromoCode__c != null ? olis[0].Opportunity.Smart_Platform_Incentive__r.PromoCode__c:null; //CRM 11446
            String viewDesign = 'display:block;border-bottom: 1px solid #ddd;';
            String hideDesign = 'display: none;';
            String includeLabel = CustomTranslations.fetchLabelTranslation(System.Label.includedLabel, olis[0].Opportunity.Contact_Name__r.Language__r.EmailCode__c);
            productsHTML = '<tr style="'+smOrLHBrandingClass+'">';
            productsHTML+= '<th colspan="1" align="left" style="text-transform: uppercase;border-bottom: 1px solid #ddd;">'+CustomTranslations.fetchLabelTranslation(system.label.ProductsLabel, olis[0].Opportunity.Contact_Name__r.Language__r.EmailCode__c);
            productsHTML+= '</th>';
            productsHTML+= '<th colspan="1" align="right" style="text-transform: uppercase;border-bottom: 1px solid #ddd;">'+CustomTranslations.fetchLabelTranslation(system.label.PricesExcludingTaxLabel, olis[0].Opportunity.Contact_Name__r.Language__r.EmailCode__c);
            productsHTML+= '</th>';
            productsHTML+= '</tr>';
            //generate HTML
            for(Opportunitylineitem objOI : olis){
                if(objOI.ProductCode == 'LHF' || objOI.ProductCode == 'LHFLX'){
                    TBVPercent = objOI.TBV_Percent__c;
                }
                if(objOI.Bundle__c != null 
                    && (objOI.ProductCode.contains('LH') 
                         || objOI.ProductCode.contains('TBB')
                         || objOI.ProductCode.contains('CM')
                         || (objOI.ProductCode.contains('_B')
                              /*&& objOI.ProductCode != CustomConstants.SITEMINDER_BUNDLE_PRODUCT_CODE
                              && objOI.ProductCode != CustomConstants.SITEMINDER_PLUS_BUNDLE_PRODUCT_CODE*/))){
                   /*Boolean isLH = objOI.Bundle__c != null && (objOI.Opportunity.LM_Products_Selection__c.contains('LH') 
                                    || objOI.Opportunity.LM_Products_Selection__c.contains(CustomConstants.SITEMINDER_BUNDLE_CODE)
                                    || objOI.Opportunity.LM_Products_Selection__c.contains(CustomConstants.SITEMINDER_PLUS_BUNDLE_CODE));*/
                    Boolean isLH = false;
                    if(objOI.Opportunity.BillMPAsBundle__c || objOI.Opportunity.LM_Products_Selection__c.contains('LH') || 
                      (objOI.Bundle__c != null && objOI.Opportunity.LM_Products_Selection__c.contains('SM') && !objOI.ProductCode.contains('SMPLUS') && !objOI.ProductCode.contains('SM_B')) ||
                      !(objOI.Bundle__c == null || objOI.ProductCode.contains('SMPLUS') || objOI.ProductCode.contains('SM_B'))){
                        if(!customconstants.lhBundleList.contains(objOI.ProductCode)){
                        isLH = true;
                        system.debug('Reached@@168');
                      }
                      if(objOI.BundleCode__c == 'LHCP' || objOI.BundleCode__c == 'LHCPTBB'  || objOI.BundleCode__c == 'LHFCP'){
                        isLH = false;
                      }              
                    }
                    productsHTML+= '<tr>';
                    productsHTML+= '<td style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                    productsHTML+= objOI.Product2.MarketingProduct__c != null && objOI.Product2.MarketingProduct__c != '' ? objOI.Product2.MarketingProduct__c  : objOI.Product2.Name;
                    productsHTML+= '</td>';
                    if(isLH){
                        productsHTML+='<td align="right" style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                        productsHTML+=includeLabel;
                        productsHTML+= '</td>';
                    } else {
                        productsHTML+='<td align="right" style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                        productsHTML+=objOI.currencyISOCode+' ';
                        productsHTML+=objOI.UnitPrice+' ';
                        productsHTML+= '</td>';
                    }
                    productsHTML+= '</tr>';   
                }
            }
            for(Opportunitylineitem objOI : olis){
                if(objOI.ProductCode == 'LHF' || objOI.ProductCode == 'LHFLX'){
                    TBVPercent = objOI.TBV_Percent__c;
                }
                if(objOI.Bundle__c == null){
                   /*Boolean isLH = objOI.Bundle__c != null && (objOI.Opportunity.LM_Products_Selection__c.contains('LH') 
                                    || objOI.Opportunity.LM_Products_Selection__c.contains(CustomConstants.SITEMINDER_BUNDLE_CODE)
                                    || objOI.Opportunity.LM_Products_Selection__c.contains(CustomConstants.SITEMINDER_PLUS_BUNDLE_CODE));*/
                    Boolean isLH = false;
                    if((objOI.Opportunity.BillMPAsBundle__c && !objOI.ProductCode.contains('RMS')) || objOI.Opportunity.LM_Products_Selection__c.contains('LH') || 
                      (objOI.Bundle__c != null && objOI.Opportunity.LM_Products_Selection__c.contains('SM') && !objOI.ProductCode.contains('SMPLUS') && !objOI.ProductCode.contains('SM_B')) ||
                      !(objOI.Bundle__c == null || objOI.ProductCode.contains('SMPLUS') || objOI.ProductCode.contains('SM_B'))){
                        isLH = true;
                        system.debug('Reached@@200');              
                    }
                    productsHTML+= '<tr>';
                    productsHTML+= '<td style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                    productsHTML+= objOI.Product2.MarketingProduct__c != null && objOI.Product2.MarketingProduct__c != '' ? objOI.Product2.MarketingProduct__c  : objOI.Product2.Name;
                    productsHTML+= '</td>';
                    if(isLH){
                        productsHTML+='<td align="right" style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                        if(objOI.Bundle__c != null || (objOI.Opportunity.BillMPAsBundle__c && objOI.ProductCode.contains('MP'))){ //8815 BS
                            productsHTML+=includeLabel;
                        }
                        else{
                            productsHTML+=objOI.currencyISOCode+' ';
                            productsHTML+=objOI.UnitPrice+' ';
                        }
                        productsHTML+= '</td>';
                    } else {
                        productsHTML+='<td align="right" style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                        productsHTML+=objOI.currencyISOCode+' ';
                        productsHTML+=objOI.UnitPrice+' ';
                        productsHTML+= '</td>';
                    }
                    productsHTML+= '</tr>';   
                }
            }
        }
    }

    public class AddOnLineItemsWrapper{
        public String productsHTML {get;set;}
        public String smOrLHBrandingClass {get;set;}
        public Boolean isRendered {get;set;}

        public String TransPromoDiscount {get;set;} //CRM 9102
        public String TranslanguagePromoDetails {get;set;} //CRM 9102
        public String TransPromoDetails {get;set;} //CRM 9102
        public Boolean isNewLang {get;set;} //CRM 9102
        public Map<String,String> transLanguagePromoDetailsMap =  new Map<String,String>(); //CRM 9102
        public Map<String,String> transPromoDetailsMap {get;set;} //CRM 9102

        public AddOnLineItemsWrapper(List<Opportunitylineitem> standardOlis, List<Opportunitylineitem> transactionOlis, Opportunity objOpportunity, 
                                    List<Promo_Discount_Products__c> promoDiscProducts, Map<String, Promo_Discount_Products__c> productDetailsMap){
				String payproduct = '';
                String promoDetails = CustomTranslations.fetchLabelTranslation(System.Label.promoDetails, standardOlis[0].Opportunity.Contact_Name__r.Language__r.EmailCode__c);  //9102
                System.debug(promoDetails);
                isNewLang = true;  //CRM 9102
                if(standardOlis != NULL && !standardOlis.isEmpty() && standardOlis[0].Opportunity.LM_Products_Selection__c != NULL && 
                    standardOlis[0].Opportunity.LM_Products_Selection__c.contains('LH')){
                    smOrLHBrandingClass = 'background: #FFA078;height: 25px;color: #fff;';    //#ff704a
                	payproduct = 'LHPAY';
				}
                else{
                    smOrLHBrandingClass = 'background: #0B7DC5;height: 25px;color: #fff;';
					payproduct = 'SMPAY';
                }
                 //CRM 9102 start
                 if(standardOlis != NULL && !standardOlis.isEmpty() && standardOlis[0].Opportunity.Contact_Name__r.LanguageName__c != NULL){
                           if(objOpportunity.DActivationRequest__c == 'Yes' && productDetailsMap.size()>0 && promoDiscProducts.size()>0){
                                getPromodetails(standardOlis, transactionOlis, objOpportunity,promoDiscProducts,productDetailsMap,'DMP');
                           }
                           if(transactionOlis != NULL && !transactionOlis.isEmpty() && transactionOlis[0].ProductCode == 'DRP' && productDetailsMap.size()>0 && promoDiscProducts.size()>0){
                                getPromodetails(standardOlis, transactionOlis, objOpportunity,promoDiscProducts,productDetailsMap,'DRP');
                           }
                }

                TransPromoDiscount = standardOlis[0].Opportunity.Transaction_Promo_Discount__r.PromoCode__c != null ?  standardOlis[0].Opportunity.Transaction_Promo_Discount__r.PromoCode__c : null;
                 //CRM 9102 end 
                isRendered = false;
                productsHTML = '<tr style="'+smOrLHBrandingClass+'">';
                productsHTML+= '<th colspan="1" align="left" style="text-transform: uppercase;border-bottom: 1px solid #ddd;">'+CustomTranslations.fetchLabelTranslation(system.label.Add_Ons, standardOlis[0].Opportunity.Contact_Name__r.Language__r.EmailCode__c);
                productsHTML+= '</th>';
                productsHTML+= '<th colspan="1" align="right" style="text-transform: uppercase;border-bottom: 1px solid #ddd;">'+CustomTranslations.fetchLabelTranslation(system.label.Commission_Fees, standardOlis[0].Opportunity.Contact_Name__r.Language__r.EmailCode__c);
                productsHTML+= '</th>';
                productsHTML+= '</tr>';
          
        
                if(objOpportunity != null && objOpportunity.DActivationRequest__c == 'Yes'){
                    isRendered = true;
                    productsHTML+= '<tr>';
                    productsHTML+= '<td style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                    productsHTML+= 'Demand Plus';
                    productsHTML+= '</td>';
                    productsHTML+='<td align="right" style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                    productsHTML+= objOpportunity.D_Comm_Rate__c + '%';
                    productsHTML+= '</td>';
                    productsHTML+= '</tr>'; 
                    //CRM 9102 start
                    if(TransLanguagePromoDetailsMap.containsKey('DMP')){
                        productsHTML += '<tr>';
                        productsHTML += '<td colspan="2" style="border-bottom: 1px solid #ddd;font-size: 14px; padding-left: 5px; color: rgb(0, 0, 0); line-height: 1.2;">';
                        productsHTML += promoDetails+':' + (TransLanguagePromoDetailsMap.get('DMP') != null ? TransLanguagePromoDetailsMap.get('DMP') : '');
                        productsHTML += '</td>';
                        productsHTML += '</tr>';
                    }
                    //CRM 9102 end  
                }
                if(objOpportunity != null && objOpportunity.CustomerInterestedInPay__c == 'Yes'){
                    isRendered = true;
                    productsHTML+= '<tr>';
                    productsHTML+= '<td style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                    productsHTML+= payproduct;//'SMPay';
                    productsHTML+= '</td>';
                    productsHTML+='<td align="right" style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                    productsHTML+= 'Per Transaction';
                    productsHTML+= '</td>';
                    productsHTML+= '</tr>'; 
                    //crm  9102 start
                    if(TransLanguagePromoDetailsMap.containsKey('SMPAY')){
                        productsHTML += '<tr>';
                        productsHTML += '<td colspan="2" style="border-bottom: 1px solid #ddd;font-size: 14px; padding-left: 5px; color: rgb(0, 0, 0); line-height: 1.2;">';
                        productsHTML += promoDetails+':' + (TransLanguagePromoDetailsMap.get('SMPAY') != null ? TransLanguagePromoDetailsMap.get('SMPAY') : '');
                        productsHTML += '</td>';
                        productsHTML += '</tr>';
                    }
                    System.debug('objOpportunity.CustomerInterestedInPay__c==>>'+objOpportunity.CustomerInterestedInPay__c);
                    //CRM 9102 end
                }
                //System.debug('transactionOlis[0] '+ transactionOlis[0]);
                if(transactionOlis != NULL && !transactionOlis.isEmpty() && transactionOlis[0].ProductCode == 'DRP'){
                    isRendered = true;
                    productsHTML+= '<tr>';
                    productsHTML+= '<td style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                    //productsHTML+= '<td style="border-bottom: 1px solid #ddd;font-size: 14px; width:25%;">';
                    productsHTML+= 'Dynamic Revenue Plus';
                    productsHTML+= '</td>';
                    //productsHTML+='<td style="border-bottom: 1px solid #ddd;font-size: 14px; width:75%;">';
                    productsHTML+='<td align="right" style="border-bottom: 1px solid #ddd;font-size: 14px;">';
                    productsHTML+= transactionOlis[0].Commission_Quoted__c + CustomTranslations.fetchLabelTranslation(system.label.Commission_Quoted_Text, standardOlis[0].Opportunity.Contact_Name__r.Language__r.EmailCode__c);
                    productsHTML+= '</td>';
                    productsHTML+= '</tr>'; 
                    //CRM 9102 start
                    if(TransLanguagePromoDetailsMap.containsKey('DRP')){
                        productsHTML += '<tr>';
                        productsHTML += '<td colspan="2" style="border-bottom: 1px solid #ddd;font-size: 14px; padding-left: 5px; color: rgb(0, 0, 0); line-height: 1.2;">';
                        productsHTML += promoDetails+':' + (TransLanguagePromoDetailsMap.get('DRP') !=null ? TransLanguagePromoDetailsMap.get('DRP'):'');
                        productsHTML += '</td>';
                        productsHTML += '</tr>';
                    }
                    //CRM 9102 end
                }
        }
        //CRM 9102 Start
        public void getPromodetails(List<Opportunitylineitem> standardOlis, List<Opportunitylineitem> transactionOlis, Opportunity objOpportunity, 
                                List<Promo_Discount_Products__c> promoDiscProducts,Map<String, Promo_Discount_Products__c> productDetailsMap,String prodCode){

            
            //TransLanguagePromoDetailsMap = new Map<String,String>();
     
            String language = standardOlis[0].Opportunity.Contact_Name__r.LanguageName__c;
            if(productDetailsMap.containsKey(prodCode)){
                if(language.containsIgnoreCase('german') && productDetailsMap.get(prodCode).Promo_Details_German__c != NULL){
                    TransLanguagePromoDetailsMap.put(prodCode,String.valueOf(productDetailsMap.get(prodCode).Promo_Details_German__c));
                }
                else if(language.containsIgnoreCase('french') && productDetailsMap.get(prodCode).Promo_Details_French__c != NULL){
                    TransLanguagePromoDetailsMap.put(prodCode,String.valueOf(productDetailsMap.get(prodCode).Promo_Details_French__c));
                }
                else if(language.containsIgnoreCase('spanish') && productDetailsMap.get(prodCode).Promo_Details_Spanish__c != NULL){
                    TransLanguagePromoDetailsMap.put(prodCode,String.valueOf(productDetailsMap.get(prodCode).Promo_Details_Spanish__c));
                }
                else if(language.containsIgnoreCase('portuguese') && productDetailsMap.get(prodCode).Promo_Details_Portuguese__c != NULL){
                    TransLanguagePromoDetailsMap.put(prodCode,String.valueof(productDetailsMap.get(prodCode).Promo_Details_Portuguese__c));
                }
                else if(language.containsIgnoreCase('italian') && productDetailsMap.get(prodCode).Promo_Details_Italian__c != NULL){
                    TransLanguagePromoDetailsMap.put(prodCode,String.valueOf(productDetailsMap.get(prodCode).Promo_Details_Italian__c));
                }
                else if(isNewLang && standardOlis[0].Opportunity.Contact_Name__r.Language__r.EmailCode__c == 'zh-TW' && productDetailsMap.get(prodCode).Promo_Details_Chinese__c != NULL){
                    TransLanguagePromoDetailsMap.put(prodCode,String.valueOf(productDetailsMap.get(prodCode).Promo_Details_Chinese__c));
                }
                else if(isNewLang && language.containsIgnoreCase('indonesian') && productDetailsMap.get(prodCode).Promo_Details_Indonesian__c != NULL){
                    TransLanguagePromoDetailsMap.put(prodCode,String.valueOf(productDetailsMap.get(prodCode).Promo_Details_Indonesian__c));
                }
                else if(isNewLang && language.containsIgnoreCase('thai') && productDetailsMap.get(prodCode).Promo_Details_Thai__c != NULL){
                    TransLanguagePromoDetailsMap.put(prodCode,String.valueOf(productDetailsMap.get(prodCode).Promo_Details_Thai__c));
                }
                else if(isNewLang && language.containsIgnoreCase('vietnamese') && productDetailsMap.get(prodCode).Promo_Details_Vietnamese__c != NULL){
                    TransLanguagePromoDetailsMap.put(prodCode,String.valueOf(productDetailsMap.get(prodCode).Promo_Details_Vietnamese__c));
                }
                else if(productDetailsMap.containsKey(prodCode) && productDetailsMap.get(prodCode).Promo_Details__c != NULL){
                    system.debug(productDetailsMap);
                    system.debug(prodCode);
                    System.debug(productDetailsMap.get(prodCode).Promo_Details__c);
                    TransLanguagePromoDetailsMap.put(prodCode, String.valueOf(productDetailsMap.get(prodCode).Promo_Details__c));
                
                }
            }
            
             
        }
        //CRM 9102 End
    }

    
}
